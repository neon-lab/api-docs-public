<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Neon Labs API Documentation</title>
  <link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16" />
  <link href='css/typography.css' media='screen' rel='stylesheet' type='text/css'/>
  <link href='css/reset.css' media='screen' rel='stylesheet' type='text/css'/>
  <link href='css/screen.css' media='screen' rel='stylesheet' type='text/css'/>
  <link href='css/reset.css' media='print' rel='stylesheet' type='text/css'/>
  <link href='css/print.css' media='print' rel='stylesheet' type='text/css'/>
  <script src='lib/jquery-1.8.0.min.js' type='text/javascript'></script>
  <script src='lib/jquery.slideto.min.js' type='text/javascript'></script>
  <script src='lib/jquery.wiggle.min.js' type='text/javascript'></script>
  <script src='lib/jquery.ba-bbq.min.js' type='text/javascript'></script>
  <script src='lib/handlebars-2.0.0.js' type='text/javascript'></script>
  <script src='lib/underscore-min.js' type='text/javascript'></script>
  <script src='lib/backbone-min.js' type='text/javascript'></script>
  <script src='swagger-ui.js' type='text/javascript'></script>
  <script src='lib/highlight.7.3.pack.js' type='text/javascript'></script>
  <script src='lib/jsoneditor.min.js' type='text/javascript'></script>
  <script src='lib/marked.js' type='text/javascript'></script>
  <script src='lib/swagger-oauth.js' type='text/javascript'></script>

  <!-- Some basic translations -->
  <!-- <script src='lang/translator.js' type='text/javascript'></script> -->
  <!-- <script src='lang/ru.js' type='text/javascript'></script> -->
  <!-- <script src='lang/en.js' type='text/javascript'></script> -->

  <script type="text/javascript">
    var NEON_LABS_AUTHENTICATION_ENDPOINT = "https://auth.neon-lab.com/api/v2/authenticate";
    var ACCESS_TOKEN_FROM_AUTHENTICATION_PAYLOAD = function(data) { return data.access_token; };
    var API_DOCUMENATION_ENDPOINT = "https://raw.githubusercontent.com/neon-lab/api-docs-public/gh-pages/public.json";

    $(function () {
      // Pre load translate...
      if(window.SwaggerTranslator) {
        window.SwaggerTranslator.translate();
      }
      window.swaggerUi = new SwaggerUi({
        url: API_DOCUMENATION_ENDPOINT,
        dom_id: "swagger-ui-container",
        supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
        onComplete: function(swaggerApi, swaggerUi){
          if(typeof initOAuth == "function") {
            initOAuth({
              clientId: "your-client-id",
              clientSecret: "your-client-secret-if-required",
              realm: "your-realms",
              appName: "your-app-name",
              scopeSeparator: ",",
              additionalQueryStringParams: {}
            });
          }

          if(window.SwaggerTranslator) {
            window.SwaggerTranslator.translate();
          }

          $('pre code').each(function(i, e) {
            hljs.highlightBlock(e)
          });

          addApiKeyAuthorization();
        },
        onFailure: function(data) {
          log("Unable to Load SwaggerUI");
        },
        docExpansion: "none",
        jsonEditor: false,
        apisSorter: "alpha",
        defaultModelRendering: 'schema',
        showRequestHeaders: false
      });

      function processApiKeyAuthorization(key) {
        if(key && key.trim() != "") {
            var apiKeyAuth = new SwaggerClient.ApiKeyAuthorization("token", key, "query");
            window.swaggerUi.api.clientAuthorizations.add("api_key", apiKeyAuth);
            log("added key " + key);
        }
      }

      function addApiKeyAuthorization(){
        var key = encodeURIComponent($('#input_apiKey')[0].value);
        return processApiKeyAuthorization(key);
      }

      var retrieveAccessToken = function(payload, callback) {
        $.ajax({
          url: NEON_LABS_AUTHENTICATION_ENDPOINT,
          type: "POST",
          data: JSON.stringify(payload),
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          success: function(data) {
            return callback(ACCESS_TOKEN_FROM_AUTHENTICATION_PAYLOAD(data));
          }
        });
      }

      $("#api_selector").submit(function(event) {
        var $signInForm = $(this);
        event.preventDefault();
        event.stopPropagation();

        var formData = $signInForm.serializeArray();
        var data = {};
        $(formData).each(function(index, obj) {
          data[obj.name] = obj.value;
        });

        retrieveAccessToken(data, processApiKeyAuthorization);
      });

      // if you have an apiKey you would like to pre-populate on the page for demonstration purposes...
      /*
        var apiKey = "myApiKeyXXXX123456789";
        $('#input_apiKey').val(apiKey);
      */

      window.swaggerUi.load();

      function log() {
        if ('console' in window) {
          console.log.apply(console, arguments);
        }
      }
  });
  </script>
</head>

<body class="swagger-section">
<div id='header'>
  <div class="swagger-ui-wrap">
    <a id="logo" href="http://neon-lab.com">Neon</a>
    <form id="api_selector">
      <div class='input'><input placeholder="username" id="username" name="username" type="text"/></div>
      <div class='input'><input placeholder="password" id="password" name="password" type="password"/></div>
      <div class='input'><input id="sign_in" type="submit" value="Sign In"/></div>
    </form>
  </div>
</div>

<div id="message-bar" class="swagger-ui-wrap" data-sw-translate>&nbsp;</div>
<div id="swagger-ui-container" class="swagger-ui-wrap"></div>

<div class="swagger-ui-wrap">
  <h1>Authorization flow</h1>

  <p>You've got your username and password and you're ready to access the API. This live documentation manages tokens for you, but you'll generally need to fetch, store, and refresh your own tokens to use Neon.</p>
  <p>You'll use your username and password to request a long-lived <code>refresh_token</code>. You can use that <code>refresh_token</code> to request a short-lived <code>access_token</code>. Your requests to the API are authenticated by sending along your access token.</p>
  <p>Each access token expires after about 12 minutes, so you'll want to store the refresh token so you can acquire new access tokens.</p>
  <p>The authentication endpoint is different from the API endpoint. It uses a different base URL (<code>https://auth.neon-lab.com</code>) and only responds to requests over HTTPS.</p>

  <h2>Call Flow</h2>

  <p>A username and password will be supplied to you when your customer account is created.</p>
  <p>Use these to call:</p>
  <pre>
POST https://auth.neon-lab.com/api/v2/authenticate

{
    "username": "yourusername",
    "password": "yourpass"
}
  </pre>

  <p>An <code>access_token</code>/<code>refresh_token</code> pair is passed back on success:</p>
  <pre>
{
    "access_token": "access_token",
    "refresh_token": "refresh_token"
}
  </pre>

  <p>Passing the <code>access_token</code> to the API can be done in three different ways:</p>

  <p>1. As the query_string parameter:</p>
  <pre>
/a123/integrations/brightcove?integration_id=15add06a5cc511e5b7da00904c0df43e&token=access_token
  </pre>

  <p>2. In the JSON-encoded body parameters:</p>
  <pre>
/api/v2/pvmprjg44t5x7cqcrsw0i6tn/integrations/brightcove

{
    "publisher_id": "123badf",
    "token": "access_token"
}
  </pre>

  <p>3. As an <code>Authorization: Bearer</code> header:</p>
  <pre>
HEADER:

Authorization: Bearer access_token
/a123/integrations/brightcove?integration_id=15add06a5cc511e5b7da00904c0df43e
  </pre>
</div>
</body>
</html>
